# Categories and patterns. Order matters: earlier categories add more risk.
version: 1
categories:

  # 1) Classic injection intents
  - name: injection_core
    weight: 3
    patterns:
      - (?i)\b(ignore|disregard|forget)\b.+\b(previous|above|earlier)\b.+\b(instruction|rule|directive)s?\b
      - (?i)\b(reveal|show|print|expose|leak)\b.+\b(system\s*prompt|hidden\s*prompt|developer\s*message)\b
      - (?i)\b(override|break|bypass)\b.+\b(safety|policy|guardrails?)\b
      - (?i)\bact as\b.+\b(system|developer|tool)\b
      - (?i)\bBEGIN\s*SYSTEM\s*PROMPT\b|\b```system\b|\b<system>\b

  # 2) Data exfil / tool abuse cues
  - name: exfil_tools
    weight: 3
    patterns:
      - (?i)\b(base64|rot13|hex)\b.+\b(encode|decode)\b
      - (?i)\b(curl|wget)\b\s+https?://
      - (?i)\bInvoke-WebRequest\b|\bPowerShell\b
      - (?i)\bfile://|s3://|gs://\b
      - (?i)\b(api[_-]?key|password|secret|token)\b.+\b(print|dump|exfil|expose|reveal)\b

  # 3) Sandbox escape / shell danger
  - name: shell_danger
    weight: 4
    patterns:
      - (?i)\b(rm\s+-rf|chmod\s+777|sudo\s+.*)\b
      - (?i)\b;?\s*(nc|netcat)\s+-e\b|\b/bin/sh\b|\bbash\s+-i\b

  # 4) Prompt-wrapping structures (role separation confusion)
  - name: wrapper_confusion
    weight: 2
    patterns:
      - (?is)\b(role|speaker)\s*:\s*(system|developer|tool)\b
      - (?is)\b(assistant|system|developer)\s*=\s*"
      - (?is)\b<assistant>.*?</assistant>|\b<system>.*?</system>

  # 5) Special-token / delimiter floods (attempt to blend)
  - name: delimiter_misuse
    weight: 1
    patterns:
      - (?s)```(?:\w+)?\s*system.*?```
      - (?s)"""(?:.*?)"""
      - (?s)^[-=~_*#]{8,}$

  # 6) Repetition (handled programmatically, but keep basic ones)
  - name: repeated_words
    weight: 1
    patterns:
      - (?i)\b(\w+)\b(?:\s+\1){3,}         # word repeated >=4 times
      - ([.!?])\1{3,}                      # punct floods

risk_thresholds:
  # Category score sum â‰¥ hard_block => immediately flag
  hard_block: 5
  warn: 3
